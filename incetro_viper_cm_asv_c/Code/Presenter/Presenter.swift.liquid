{% include 'header' %}

{% replacement = custom_parameters.plain }
{% assign plain_tail_count = replacement | size | minus: 1 %}
{% assign plain_first_letter = replacement | slice: 0 | downcase %}
{% assign plain_without_first_letter = replacement | slice: 1, plain_tail_count %}
{% assign plain_uncap = plain_first_letter | append: plain_without_first_letter %}
{% comment %}
{% It's necessary to use `swiftlint autocorrect` after generating this module because there will be empty lines %}
{% endcomment %}

import Foundation

// MARK: - {{ prefix }}{{ module_info.name }}Presenter

final class {{ prefix }}{{ module_info.name }}Presenter {
    
    // MARK: - Properties
    
    /// ModuleOutput instance
    weak var output: {{ prefix }}{{ module_info.name }}ModuleOutput?

    /// View instance
    weak var view: {{ prefix }}{{ module_info.name }}ViewInput?

    /// Interactor instance
    var interactor: {{ prefix }}{{ module_info.name }}InteractorInput?

    /// Router instance
    var router: {{ prefix }}{{ module_info.name }}RouterInput?
    
    /// {{ prefix }}{{ module_info.name }}ViewModelProtocol factory
    private let viewModelDesigner: {{ prefix }}{{ module_info.name }}ViewModelDesigner

    /// Current {{ plain_uncap }} instance
    private let {{ plain_uncap }}: {{ custom_parameters.plain }}PlainObject

    // MARK: - Initializers

    /// Default initializer
    /// - Parameters:
    ///   - viewModelDesigner: {{ prefix }}{{ module_info.name }}ViewModelProtocol factory
    ///   - {{ plain_uncap }}: current {{ plain_uncap }} instance
    init(
        viewModelDesigner: {{ prefix }}{{ module_info.name }}ViewModelDesigner,
        {{ plain_uncap }}: {{ custom_parameters.plain }}PlainObject
    ) {
        self.viewModelDesigner = viewModelDesigner
        self.{{ plain_uncap }} = {{ replacement_uncap }}
    }
}

// MARK: - {{ prefix }}{{ module_info.name }}ViewOutput

extension {{ prefix }}{{ module_info.name }}Presenter: {{ prefix }}{{ module_info.name }}ViewOutput {
    
    func didTriggerViewReadyEvent() {
        view?.setupInitialState()
        let viewModel = viewModelDesigner.viewModel(from: {{ plain_uncap }})
        view?.update(viewModel)
    }
}

// MARK: - {{ prefix }}{{ module_info.name }}InteractorOutput

extension {{ prefix }}{{ module_info.name }}Presenter: {{ prefix }}{{ module_info.name }}InteractorOutput {
    
    func processErrorMessage(_ errorMessage: String) {
        view?.stopIndication()
        view?.showErrorMessage(errorMessage)
    }
}

// MARK: - {{ prefix }}{{ module_info.name }}ModuleInput

extension {{ prefix }}{{ module_info.name }}Presenter: {{ prefix }}{{ module_info.name }}ModuleInput {
    
    func setModuleOutput(_ moduleOutput: ModuleOutput) {
        output = moduleOutput as? {{ prefix }}{{ module_info.name }}ModuleOutput
    }
}
